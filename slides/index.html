<!doctype html>
<html>
  <head>
    <!-- Slide framework: reveal.js (https://github.com/hakimel/reveal.js) -->

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Consumer-driven contract testing</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/thoughtworks.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <style>
      li {
        /*
         * Hack to fix thoughtworks theme:
         * Align subsequent lines with start of first line
         * rather than wrapping underneath the bullet point.
         */
        padding-left: 0.1em;
        text-indent: -1.2em;
      }
      .reveal strong {
        font-weight: normal;
        font-family: 'Open Sans Bold';
      }
      .reveal li {
        margin-bottom: 0.5em;
      }
      .reveal .footnote {
        position: fixed;
        bottom: -50px;
        width: 100%;
        font-size: 0.9em;
      }
      .highlighted {
        background-color: yellow;
      }
    </style>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section class="title present" style="padding-top: 6em;">
          <h1>Consumer-driven contract testing</h1>
        </section>
        <section>
          <h2>Problem</h2>

          <p>Consider Consumer-Driven Contracts as a Design Pattern.</p>

          <blockquote>
            <p><strong>Problem statement:</strong></p>
            <p>
              <span class="fragment">How can a web service API reflect its clients' needs<br></span>
              <span class="fragment">while enabling evolution<br></span>
              <span class="fragment">and avoiding breaking clients?<br></span>
            </p>
          </blockquote>

          <p class="footnote">
            [1] Ian Robinson, <i>Consumer-Driven Contracts</i>, <a href="http://www.servicedesignpatterns.com/WebServiceEvolution/ConsumerDrivenContracts"><i>Service Design Patterns</i></a>
          </p>
        </section>
        <section>
          <h2>Options</h2>

          <p>How can we prevent breaking changes to services?</p>

          <ol style="width: 75%;">
            <li class="fragment"><strong>Option 1:</strong> service providers create APIs that attempt to address all current and future consumer needs.</li>
            <li class="fragment"><strong>Option 2:</strong> service providers write tests based on an interpretation of how consumers might use the service.</li>
            <li class="fragment"><strong>Option 3:</strong> consumers provide documentation to providers specifying how they expect to use the service.</li>
            <li class="fragment"><strong>Option 4:</strong> <span class="highlighted">something else?</span></li>
          </ol>

          <p class="footnote">
            [1] Ian Robinson, <i>Consumer-Driven Contracts</i>, <a href="http://www.servicedesignpatterns.com/WebServiceEvolution/ConsumerDrivenContracts"><i>Service Design Patterns</i></a>
          </p>
        </section>
        <section>
          <h2>Solution</h2>

          <ul>
            <li class="fragment">
              Consumer developers write automated integration tests that express their expectations of a service API.
            </li>
            <li class="fragment">
              These tests are accepted by the service owner, who incorporates them into the service's test suite.
              (They enter into a contract.)
            </li>
          </ul>

          <p class="fragment"><strong>The set of integration tests received from all existing consumers represents the service's obligations to its consumer base.</strong></p>

          <p class="footnote">
            [1] Ian Robinson, <i>Consumer-Driven Contracts</i>, <a href="http://www.servicedesignpatterns.com/WebServiceEvolution/ConsumerDrivenContracts"><i>Service Design Patterns</i></a>
          </p>
        </section>
        <section>
          <h2>Context</h2>

          <p>Consumer-Driven Contracts don't make sense everywhere.</p>

          <p>They should be used when:</p>

          <ol style="width: 75%;">
            <li class="fragment">A service has several consumers, each with different needs.</li>
            <li class="fragment">Service owners know who their consumers are, and</li>
            <li class="fragment">Client developers are able to communicate their expectations of the service's API to service owners.</li>
          </ol>

          <p class="fragment">
            Best used between teams with independent release cycles.
            Could result in overhead with minimal value for providers/consumers in same team.
          </p>

          <p class="footnote">
            [1] Ian Robinson, <i>Consumer-Driven Contracts</i>, <a href="http://www.servicedesignpatterns.com/WebServiceEvolution/ConsumerDrivenContracts"><i>Service Design Patterns</i></a>
          </p>
        </section>
        <section>
          <h2>Notes</h2>

          <ul>
            <li>Consumers publish tests, run by provider</li>
            <li>Test both consumer and service against contract</li>
          </ul>
        </section>
        <section>
          <h2>Evolving a service</h2>

          <ol>
            <li class="fragment">Consumer identifies need from provider that's not currently met.</li>
            <li class="fragment">Consumer collaborates with provider to define API that satisfies new need whilst considering constraints and considerations of the provider.</li>
            <li class="fragment">Provider implements API to honour agreed contract (and old ones).</li>
            <li class="fragment">Provider runs automated test to verify that API satisfies the contract.</li>
            <li class="fragment">Provider publishes new service; consumer publishes new contract tests.</li>
          </ol>

          <p class="fragment"><em>Contracts codify the result of conversations - they don't replace them.</em></p>

          <p class="footnote">
            [1] <a href="http://www.slideshare.net/QaiserMazhar/microservices-consumer-driven-contracts-in-practice">Microservices: Consumer Driven Contracts in Practice</a>
          </p>
        </section>
        <section>
          <h2>Stubbing service dependencies</h2>

          <blockquote>
            Consuming services usually cannot test against live suppliers since such tests are
            slow and brittle, so it’s best to use Test Doubles, leading to the danger that
            the test doubles get out of sync with the real supplier service. Consumer teams
            can protect themselves from these failures by using integration contract tests –
            tests that compare actual service responses with test values.
          </blockquote>

          <p class="footnote">
            [1] <a href="https://www.thoughtworks.com/radar/techniques/consumer-driven-contract-testing">ThoughtWorks Technology Radar: Consumer-driven contract testing</a>
          </p>
        </section>
        <section>
          <h2>Frameworks</h2>

          <ul>
            <li><a href="https://github.com/realestate-com-au/pact">Pact</a> (realestate.com.au)</li>
            <li>Pacto (ThoughtWorks)</li>
          </ul>

          <p>Allows testing of both consumer and provider using fast unit tests.</p>
        </section>
        <section>
          <h2>Pact: Consumer side</h2>

          <p>
            <strong>Service consumers</strong> define the requests they'll make and the responses they expect back.
            <span class="highlighted">These expectations are used in consumer tests</span> to provide a mock service provider.
          </p>

          <img src="img/pact-record.png" class="no-border" style="width: 760px;" />

          <p class="footnote">
            [1] <a href="https://github.com/realestate-com-au/pact">GitHub: realestate-com-au/pact</a>
          </p>
        </section>
        <section>
          <h2>Pact: Provider side</h2>

          <p>
            Recorded interactions with the consumer are <span class="highlighted">played back in the
            service provider tests</span> to ensure the <strong>service provider</strong> actually does provide
            the response the consumer expects.
          </p>

          <img src="img/pact-replay.png" class="no-border" style="width: 780px;" />

          <p class="footnote">
            [1] <a href="https://github.com/realestate-com-au/pact">GitHub: realestate-com-au/pact</a>
          </p>
        </section>
        <section>
          <h2>References</h2>
          <ul>
            <li><a href="http://martinfowler.com/articles/consumerDrivenContracts.html">Consumer-Driven Contracts: A Service Evolution Pattern</a></li>
          </ul>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // More info https://github.com/hakimel/reveal.js/#presentation-size
        width: 1280,
        height: 720,

        transition: 'none',
        controls: false,
        center: false,
        history: true,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });
    </script>
  </body>
</html>
